<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rgb.grw.dao.ReservationDaoImpl">

	<select id="getBook" resultType="ReservationDto">
	
	
	SELECT *
		FROM RESERVATION r
		WHERE (BK_STDAY BETWEEN #{startDate} AND #{endDate} 
				OR BK_EDDAY BETWEEN  #{startDate} AND #{endDate})
		ORDER BY BK_REGDATE DESC
	
<!-- 	SELECT * -->
<!-- 		 FROM (			 -->
<!-- 		  		SELECT r.*, AUTH_NO, ROW_NUMBER () OVER(ORDER BY BK_STDAY) RN -->
<!-- 				FROM RESERVATION r JOIN EMP e  -->
<!-- 				ON r.BK_EMPNO = e.EMP_NO  -->
<!-- 		  		WHERE BK_STDAY BETWEEN #{startDate} AND #{endDate} -->
<!-- 		  		OR BK_EDDAY BETWEEN  #{startDate} AND #{endDate} -->
<!-- 		  ) -->
<!-- 	WHERE RN BETWEEN #{first} AND #{last} -->
<!-- 	OREDR BY BK_REGDATE DESC -->
<!-- 		 AND BK_STATE = #{bk_state}  -->
	</select>
	
	<select id="getBookUser" resultType="ReservationDto">
	SELECT *
		FROM RESERVATION r
		WHERE (BK_STDAY BETWEEN #{startDate} AND #{endDate} 
				OR BK_EDDAY BETWEEN  #{startDate} AND #{endDate})
		AND BK_EMPNO = #{bk_empno}
		ORDER BY BK_REGDATE DESC
<!-- 		 AND BK_STATE = #{bk_state}  -->
	</select>
	
	<select id="getAllBook" resultType="ReservationDto">
		SELECT *
		FROM RESERVATION r
		WHERE (BK_STDAY BETWEEN #{startDate} AND #{endDate})
		OR BK_EDDAY BETWEEN #{startDate} AND #{endDate}
	</select>
	
	<select id="countBook" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM RESERVATION
		WHERE BK_STDAY BETWEEN #{startDate} AND #{endDate}
		OR BK_EDDAY BETWEEN #{startDate} AND #{endDate}
	</select>
	
	<select id="countBookUser" resultType="java.lang.Integer">
	
		SELECT COUNT(*)
		FROM RESERVATION
		WHERE (BK_STDAY BETWEEN #{startDate} AND #{endDate}
				OR BK_EDDAY BETWEEN #{startDate} AND #{endDate})
		AND BK_EMPNO = #{bk_empno}
		
	</select>
	
	<insert id="insertReservation">
	INSERT INTO RESERVATION(BK_NO, FC_NO, BK_EMPNO, 
   								BK_TITLE, BK_CONTENT , BK_STDAY, 
   								BK_EDDAY, BK_NAME, BK_DEP,
   								BK_REGDATE) 
  	VALUES ((SELECT NVL(MAX(BK_NO),0)+1 FROM RESERVATION), #{fc_no}, #{bk_empno}, 
  						#{bk_title}, #{bk_content}, TO_TIMESTAMP(#{bk_stday}, 'YYYY-MM-DD HH24:MI:SS'),
  						TO_TIMESTAMP(#{bk_edday}, 'YYYY-MM-DD HH24:MI:SS'), #{bk_name}, #{bk_dep}, CURRENT_TIMESTAMP)
	</insert>
	
	

</mapper>
