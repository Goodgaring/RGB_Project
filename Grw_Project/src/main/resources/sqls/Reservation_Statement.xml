<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rgb.grw.dao.ReservationDaoImpl">

	<select id="getBook" resultType="ReservationDto">
	SELECT *
		 FROM (			
		  		SELECT r.*, AUTH_NO, ROW_NUMBER () OVER(ORDER BY BK_STDAY) RN
				FROM RESERVATION r JOIN EMP e 
				ON r.BK_EMPNO = e.EMP_NO 
		  		WHERE BK_STDAY BETWEEN #{startDate} AND #{endDate}
		  		OR BK_EDDAY BETWEEN  #{startDate} AND #{endDate}
		  )
	WHERE RN BETWEEN #{first} AND #{last}
<!-- 		 AND BK_STATE = #{bk_state}  -->
	</select>
	
	<select id="getBookUser" resultType="ReservationDto">
	SELECT *
		 FROM (			
		  		SELECT r.*, AUTH_NO, ROW_NUMBER () OVER(ORDER BY BK_STDAY) RN
				FROM RESERVATION r JOIN EMP e 
				ON r.BK_EMPNO = e.EMP_NO 
		  		WHERE BK_STDAY BETWEEN #{startDate} AND #{endDate}
		  		OR BK_EDDAY BETWEEN  #{startDate} AND #{endDate}
		  )
	WHERE RN BETWEEN #{first} AND #{last}
	AND BK_EMPNO = #{bk_empno}
<!-- 		 AND BK_STATE = #{bk_state}  -->
	</select>
	
	<select id="getAllBook" parameterType="java.util.Map" resultType="ReservationDto">
		SELECT *
		FROM RESERVATION r
		WHERE (BK_STDAY BETWEEN #{startDate} AND #{endDate})
		OR BK_EDDAY BETWEEN #{startDate} AND #{endDate}
	</select>
	
	<select id="countBook" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM RESERVATION
		WHERE BK_STDAY BETWEEN #{startDate} AND #{endDate}
		OR BK_EDDAY BETWEEN #{startDate} AND #{endDate}
	</select>
	
	<select id="countBookUser" resultType="java.lang.Integer">
	
		SELECT COUNT(*)
		FROM RESERVATION
		WHERE (BK_STDAY BETWEEN #{startDate} AND #{endDate}
				OR BK_EDDAY BETWEEN #{startDate} AND #{endDate})
		AND BK_EMPNO = #{bk_empno}
		
	</select>
	
	

</mapper>
