<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.rgb.grw.dao.TemplatePreviewDaoImpl">
	<select id="selectTemplate" resultType="TemplatePreviewDto">
		SELECT TEMP_ID,
		TEMP_TITLE, TEMP_CONTENT, TEMP_REGDATE, TEMP_EDITDATE
		FROM TEMPLATE t
	</select>
	
	<select id="jsTree" resultType="JsTreeResponseDto">
		SELECT 
		    d.DEP_NO AS id, 
		    d.DEP_NAME AS text, 
		    '#' AS parent, 
		    NULL AS tier_no, 
		    NULL AS tier_name, 
		    NULL AS dep_name
		FROM EMP e
		JOIN DEP d ON e.DEP_NO = d.DEP_NO
		UNION
		SELECT 
		    e.EMP_NO AS id, 
		    e.EMP_NAME AS text, 
		    d.DEP_NO AS parent, 
		    SUBSTR(t.TIER_NO, 4) AS tier_no,
		    t.TIER_NAME AS tier_name,
		    d.DEP_NAME AS dep_name  
		FROM EMP e
		JOIN TIER t ON e.TIER_NO = t.TIER_NO
		JOIN DEP d ON e.DEP_NO = d.DEP_NO
	</select>
	
	<insert id="insertDocument" parameterType="DocumentDto" >
		INSERT INTO RGB.DOCUMENT
		    (DOC_NO, EMP_NO, STA_CODE, 
		     TEMP_ID, DOC_REGDATE, DOC_CONTENT,
		     DOC_EXP, DOC_DELFLAG, DOC_EVTON, 
		     DOC_EVTOFF, DOC_NAME)
		VALUES (
		    'D' || LPAD(TO_CHAR(DOC_NO_SEQ.NEXTVAL), 3, '0'), #{emp_no}, 1,
		    #{temp_id}, TO_TIMESTAMP(#{doc_regdate}, 'YYYY-MM-DD'), #{doc_content},  
		    TO_TIMESTAMP(#{doc_exp}, 'YYYY-MM-DD'), 'N',  TO_TIMESTAMP(#{doc_evton}, 'YYYY-MM-DD'),
		    TO_TIMESTAMP(#{doc_evtoff}, 'YYYY-MM-DD'), #{doc_name}
		)
	</insert>
	
	<insert id="insertApproval" parameterType="ApproverDto">
		INSERT INTO RGB.APPROVER
			(EMP_NO, APP_PROCEDURE)
			VALUES(#{emp_no}, 1)
	</insert>
	
	<insert id="insertReference" parameterType="ReferrerDto">
		INSERT INTO RGB.REFERRER
			(EMP_NO, REFFER_AUTH)
			VALUES(#{emp_no}, 'Y')
	</insert>
</mapper>
